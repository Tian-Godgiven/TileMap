2/28
	14:11：目前最重要的待办事项：
		1.毕设本体：6月答辩
		2.毕设论文：4月5号之前必须要交初稿
		3.求职简历，春招：3月甚至4月就要开始，实习也和这件事挂钩
		

		事项解析：
	1.毕设必须加快进度，暂时先放弃模块之间互动，优先做出：
		（1）文件夹式的嵌套
		（2）外观设计
		（3）基础的保存载入等功能
		（4）移动端开发
		（5）软件化
	2.论文还有一段时间，首先要把论文内容摸清楚，我是要介绍这个软件的功能+这个软件所蕴含的技术价值，最好和老师商讨一下！
	3.简历必须做至少一份出来，到时候春招要有东西投出去，实习的事情再问清楚，到底可不可以走后门，毕竟我现在毕设进度差挺大的！
	4.总之要开始干活了，这就是你12,1,2月份缺席的代价！		

14:25：
	暂时放弃对线条对象和组合体对象的调试，将重心放在画布对象与tile对象上，优先完成画布嵌套，磁贴内容编辑功能。
	首先就得从对象功能入手，先完成画布对象的各种基础功能吧，首先是画布的样式管理，随后是画布功能！

15:54：完成了画布名称的显示和重命名
16:21：完成了画布尺寸的显示和输入改变，画布成员暂缓到画布嵌套的完成

------

2/29
	11:55：完成了画布背景颜色的显示和调用调色器改变

------

3/1
	1:03：完成了画布网格的功能，制作了Input带上下值按钮小部件，优化了选色器设计	
	15:18：上工，开始制作画布背景，允许用户上传图片作为画布的背景

------------

3/2
	1:04：完成了画布背景的各项功能的制作，优化了调用return_focusing_huabu()的逻辑，之后调用时，若需要请务必做好条件判断！初步完成了画布删除，还需要进一步打磨！明天顺便吧输入注释（长宽，左上）还有画布尺寸选择给做了吧！
	20:36：关于画布操作与嵌套画布功能的思考
			首先需要明确一点的是，所有画布都需要在huabu_container下才能正确运行，因此当打开某个嵌套画布时，这个画布会在出现在画布栏中，可以切换与移动画布按钮。

1.嵌套画布本质上需要放置在huabu_container下，并添加nested标签。
2.这些画布的在显示名称时，会显示[“对应磁贴名称”>“该画布的名称”]。
3.这些嵌套画布可以被关闭，也可以“回到上一画布”，也可以被删除
4.当这些嵌套画布的上层画布被删除时，其对应的磁贴会被删除，因此也应当删除这些嵌套画布
	4.1.但是每次删除画布时都要扫描一遍所有的磁贴会过于耗时，因此采用在创建嵌套画布时，将这些画布对象存储进其上层画布的“next_nested_huabu”的data对象中，并在删除一个画布时，删除其next_nested_huabu数据属性中的画布对象
5.这些嵌套画布在未调用时会赋予nesting属性，此时其不可见，并且也没有对应的画布按钮
6.嵌套画布的被调用时，回复与unNesting属性，此时其存在对应的画布按钮，并且被视作正在显示的画布对象，若此时其前方或后方，并非其上n层嵌套的画布关闭，可以顺延到这个嵌套画布

​	23:02：初步完成了画布拷贝功能，至此初步完成了画布的右侧功能栏功能，接下来开始制作画布右键菜单功能
​	23:34：上来就是王炸的复制粘贴功能，要不还是缓一缓吧，改优化右侧功能栏+底部换页功能	

------

3/3
	11:45：开始完成底部的换页功能，然后要做一下右侧功能栏里画布尺寸的选择功能
	15:42：完成了底部换页功能，做一下选尺寸功能，然后决定做tile的修饰了，做到最后会涉及画布嵌套，然后再回来

------------

3/25
	20:48：我希望能够有一个同步磁贴的功能，两个磁贴可以在内容，嵌套等各方面完全同步，可以用于多个画布之间。→没必要做，复制一个磁贴不就好了？

3/27
	11:52：在右侧的磁贴样式的文本中加入“磁贴文本”的内容以修改磁贴显示的标题吧→做了

------

4/6
	9:48：要做文件的导入导出，对象集合编辑菜单

------

4/7
	10:03：做完了导入导出，集合编辑菜单。今天要做左侧的快捷使用+搜索.
快捷使用：一个特殊的“自定义菜单”，无法删除，取而代之的是清空，保留有其他的功能
搜索：将对应type的对象所在的集合展开，并令这些对象出现蓝色聚焦框，搜索内容为空时，清除这些蓝色聚焦框
个人主页：制作设计和样式，暂时不做功能

然后开始做样式，把初稿的截图做好，最后再来做功能吧！	

​	14:17：做完了搜索，开始做快捷使用，重点是

------

4/8
	20:47：初步做完了样式，开始检查菜单，整理一下还有哪些没做：

13.磁贴形状
2.线条对象和对应的保存系统，连线模式
3.组合体对象和对应的保存系统
1.工程文件系统+文件头和读取系统
17.导入导出不同对象的菜单

8.数据库
9.服务器搭建和响应

4.登录注册功能，发送邮件
5.用户界面
19.头像裁剪
7.文件上传和下载功能

6.房间管理菜单
14.在线合作功能

10.重做和撤销
11.插入图片和表格
12.复制和粘贴
16.语言切换
18.搜索对象


15.导出可嵌套的文件功能

20.论文写完

------

4.9
	10:49：磁贴形状暂且就用svg或者透明的png来做吧，实在是没有更多时间了，给两个简单切换形状功能吧 ，比如方形，圆形？就这俩也太寒碜了，要不干脆不做了？想一想吧，总之复杂的形状就靠背景图片来实现了	

开始做线条对象，内容包括：
			1.连线模式下点击两个磁贴可以将其相互连接
			2.线条的菜单，删除，颜色，样式，粗度，箭头
			3.连线模式的子菜单，可以选定接下来制作的线条的样式
			4.线条的选中，在右侧design修改其样式
			5.线条对象如何保存，因为是svg所以可以直接将代码存入？或者是记录其连接的对象的id，在读取时重新生成？样式也用类似的方式保存下来?

22:56：以上全部没有实现，笑死

------

4/10
	16:13：完成的线条对象，线条画布，还差文件/逆文件化，正在做画布顶部工具和样式修改功能
	19:06：完成了……完成了什么？总之继续把画布顶部工具的线条做完

---

4/11
	14:57：线条对象基本做完了，组合体的选中生成很顺利，接下来要做组合体的固定功能
	15:03：不对……组合体的修饰和内容也要做……包括：
1.组合/解除组合
2.颜色
3.尺寸（比例限制
4.层叠
5.位置
6.加入（记忆面包
	20:25：记忆面包最后做，其他的修饰做完了，接下来要搞模板添加进去了
	思路大概就是：将其转化为json，由内容tile组成，然后读取生成迷你版本的block，json内容为，要做区分吗？没必要吧？反正模板和磁贴都是一样的，但是导出时应用的函数不一样！所以json文件内容得改改，object_type,object_data
tile:{

}这样

组合体的miniblock没有做！

4/12
	0:40：完成了模版对象的生成和保存
	0:52：bug如下：新生成的模板对象在画布缩放的情况下拖动出现异常
							做错了一个：新生的模版对象不应该给磁贴加事件之类的，只加样式就好了，useTile在useComposite里面
	9:06：整理一下：
	首先有两种情况的对象生成：1.仅css
													2.加载数据
关于1：从右侧拖动出来时，需要调用的内容，此时不需要将type中的数据填装进去，type中的数据也应当是默认为无的
2.加载工程文件时需要向其中填装的数据

与此同时【进入画布】函数会影响两者，应该在加载完再调用
还有abilty，这个也应该是在进入画布时调用

所以就应该是先加载数据，再进入画布，再ability

问题2：拖动对象生成clone：这个clone是只有css数据的，没有内部数据，因此需要填装进一些att和prop。

所以仅css的tile就要调用一个函数来填装默认的attr和prop了

整理一下

从左侧创建→生成css的helper→clone它→填装默认的attr,prop,data→

等等，既然是预装载的模板，那么肯定是没有attr，prop和多余的data的，所以“填装默认的attr，prop，data完全就是无稽之谈啊，这一步不需要改的，如果是用户自己保存的内容，为什么要给他改了呢。至于说嵌套画布的textblock内容，那个确实需要改……？→不改了，直接提示没有这个对象就行，谁让用户把他放进去的。

那么也就是说两边填装属性的操作其实是一样的
但问题在于模板对象在进入画布时，还要给其中的内容进行属性填装和ability啊

总之ability和属性填装是可以放在一起的，先填装属性，再ability

从左侧创建→生成css的helper→clone它→【填装属性→ability】=useTile→放进画布
加载文件→生成css的对象→【填装属性→ability】→放进画布

那么模板呢？

模板对象是：

从左侧创建→生成模板对象和子对象的css的helper→clone它→模板对象不需要填装属性，但是其中的子对象需要→模板对象ability，子对象也需要ability→模板对象放进画布，子对象需要huabu_object标签

简而言之就是要加载一下【子对象的内容】，但问题是子对象的json只在加载composite时存在啊，那这个json数据还要跟随着流一起移动了

也就是说useComposite这个函数里面应该加载子对象的stateTileByType，并且给他们ability，再添加Huabu_object标签

问题来了，useTile需要json，但我要怎么保证子对象和json保持对应呢笑死

这些json要怎么和子元素绑定在一起？

也就是说我不能保证json和子元素绑定在一起，因此我需要在生成component时为其添加内容，但问题又来了，helper的clone

在创建对象时，我们可以调用createObject(json)→jsonToObject（json,full)→将获得的object的位置信息改变→放进画布

姑且算是解决了吧，接下来要做工程文件和对应系统了

​	

```
<tilemap name="" style="" infomation="">
    <huabu css = ""  attr="" prop = "" >
    	<tile css= "" attr="">
		</tile>
	</huabu>
</tilemap>
```



保存工程文件时，我们还要保留这些元素的id！！！！！！！！~~！！！！

那class呢？

我们没有在composite中保存线条对象的信息！要怎么将其重新连接到tile上？？

在生成组合体的时候，其tile元素会失去id，那么线条要怎么才能连上去？
如何生成线条元素？jsonToLine需要start和end的id，在读取文件时当然好办，但是创建一一个composite时怎么做得到？

在生成组合体时，其中的tile是没有id的，那么要不我们先给他们一个id？进入画布之后这个id会被useTile给覆盖，所以没关系？

那么也就是说有两种方式：一种是赋予新id，一种是生成这个对象，所以不赋予新id



如果是css，那么它就不会有新的id

如果的new，那么它就会有新的id

如果是file，也不会有新的id

做了半天什么东西啊我靠

------

textblock应该获取tile相对于画布的实际位置

应该把“新建画布”在创建文件前变成“新建文件”

bug:读取的tilemap文件中的组合体的线条无法正确绑定到对应的元素上

问题似乎是组合体内的tile元素在load时，没有进入组合体内？显示b.parent()是画布

另外则是调用了许多次，原因不明

------

4/13
	9:04：今天的目标是解决文件系统，目前包括

→做完了，目前没有发现bug1.读取 
→做完了，顺便还做了一些快捷键！2.自动保存

3.另存为：可以另存为图片和html：html的话，会在加载时为其中的元素附加功能
	导出图片简单用插件就行
	导出html的话，就包括了画布栏和button栏，如果只有一个画布就没有button栏
	在加载这个html文件时，执行use函数为其中的元素附加功能
功能包括：tile的【拖拽，可选】+点击跳转画布/连接/显示textblock
				composite的拖拽，也是可选
				线条的跟随拖拽移动
				textblock中，miniblock的跳转
这个menu的界面：

图片｜选
html｜
		｜
我服了这个功能这么难做的吗，只做完了png的预览

4.软件整体的导入导出：也就是导入/导出huabu，collection，【object，composite】
5.关闭文件：关闭并保存文件
6.另外还要把textblock的位置
7.和“新建画布“给优化一下
8.还有就是画布按钮栏左下角加一个显示所有画布包括隐藏中的嵌套画布的按键

这些都做完了就开始做撤销重做复制粘贴

画布工具栏的切换箭头功能有问题

只做完了png的预览……好麻烦啊我靠！html文件的生成等一会吧要不？

0:20： 做完了Png的生成……还好，不是特别麻烦，但是Html的生成就要靠后一点了……
		先把不能往后拖的做了，关闭文件，textblock，新建画布给做了
		做了关闭文件，接下来做新建画布的限制
		做好了捏，挺简单的！
		接下来做textblock位置的判定，这个简单，调用atob就好了
		做完了捏，so easy，那么再修一下切换箭头功能
		修好了，是调用域不对的问题

1:03：做了点击名字新建or打开，今天就到这里吧。

------

4/14
	9:37:上午要做导入和导出，功能都是有的，但是要做菜单
导入菜单：分为3种模式：画布，集合，对象
		画布：打开一个工程文件，如果是前者，则要选择其中的n张画布
					随后将其导入进当前工程文件
		集合：打开一个集合文件，完全等同于“导入集合”
		对象：打开一个对象文件，随后选择将其加入指定的集合

导出菜单：同上
		画布：选择当前工程文件的n张画布，将其导出为一个工程文件，其中只有选择的n张画布
		集合：选择当前的一个集合，导出为集合文件，完全等同于导出集合
		对象：选择当前软件中的某个对象，将其导出为对象文件

那么现在的问题就是要如何区分工程文件/集合文件/对象文件？
加文件头肯定是有效的，直接判断其中的内容也是可以的
工程文件就简单了，直接有一个“.tilemap”额，不行，其他的文件也应该是这样的！

做错了！！！！！！

​	

做完咯！
		

剩下的时间做：

done 1.打开软件的时候可以进行操作，保存的时候再创建文件！	大概解决了捏没有太多测试！	

done 2.自动保存有问题，一打开就会开启？？？→是刷新的过，不过还是做了一些优化
done 3.关闭文件时也要关闭自动保存！→轻轻松松加一行代码

done 4.提示保存，然而记得在撤销堆栈添加时加一个嗷！！！！

撤销重做复制粘贴：
可以撤回的操作：
	画布大小，颜色，背景的调整，重命名，创建，删除，
	磁贴颜色，背景，标题，移动，旋转，大小改变，限制比例选项，边框修改，层叠修改……
	线条：在磁贴移动后刷新线条位置，其他的不用做
	组合体：位置，大小，组合/解除组合

不能产生新的dom啊！等等，也可以？使用id！

4/15
	9:28：撤回算是做出来了？还有些特例，还要每个去测试一下，但是我觉得是不是应该换一种做法？不是生成而是应用？生成的话各种地方都不好！
	更好的做法是保存json数据，然后应用到对应的对象上！而不是重新创造！
	另外还有一点就是重做！要怎么做成双向列表的样子？

双向列表的做法：
	在修改前push进列表，将当前指针以后的内容删除，用数据覆盖当前指针，列表长度+1，并且列表指针向后+1→状态A undo 到状态B 之后push状态C，此时状态A应该消失
	列表前后共40长度，如果达到上限，此时push进列表，则最开头的状态消失

​	undo则列表指针-1，引用对应的样式，undo时若当前指针为空，则将对象当前状态存储到当前指针之后，作为redo的样式
​	redo则列表指针+1，引用对应的样式
​	

也就是说进行操作将元素从A→B→C时，分别保存A，B状态，每次保存指针向后+1

A→B→空的，指针从1开始
		        ↑在这里

此时进行撤销的话，指针内容为空时则会保存C状态，然后指针-1，读取此时的B状态，转换到B状态

A→B→C
	↑在这里

此时进行重做的话，指针+1，转换到C状态，

A→B→C
			↑这里

​				此时撤销，就不会额外保存了，而是直接移到B

此时进行修改B→D的话，会先移除包括B在内的，之后的所有状态

也就是先变成

A→空

然后再将B→D中的B保存进来

A→B→空
			↑在这里



问题是，当我加载一个画布时，我要如何进行撤销？
当我加载一画布后，移动了A，此时撤销A，应当令A回到初始状态，但是这个初始状态是什么？

所以保留初始状态没有问题！问题是什么时候保留当前状态？

末尾为空时需要保留，切换对象时，也需要保留！







done→5.全屏

感觉没必要啊！→7.alert

done !6.分离页面

done ！4.搜索

8快捷键

新建：ctrl+n
打开：ctrl+o
保存：ctrl+s

撤销：ctrl+z
重做：ctrl+y
见切：ctrl+x
复制：ctrl+c
粘贴：ctrl+v

删除：ctrl+d

搜索：ctrl+f
全选：ctrl+a
连线模式：ctrl+空格

13.上传下载















html文件化

12.画布的拷贝

13插入图片/表格/连接

14加入集合

15改变形状

10.collection菜单

11.line的样式和内容，collection的内容

12。脱离了磁贴的磁贴内容块的删除与磁贴的删除，以及在这之上的包含了磁贴的组合体的删除，哦对还有磁贴内容块是否能够进入组合体……好多！
干脆把textblock变成一个画布内对象得了………………！不行……要加的太多了！干脆让磁铁进入画布时生成他的textblock？
至少做一个当磁贴绑定的textblock不存在时，令其重新进入绑定状态吧

13.嵌套画布不存在时进入画布产生提示

14：组合and解除组合的撤回重做有问题
